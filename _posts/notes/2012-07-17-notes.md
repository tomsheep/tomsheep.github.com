---
layout: post
category : 儒林外史
title: 屌丝的自我修养（73）
date: 2012-07-17 23:41:59 +08:00
tagline:
tags: [Yahoo, Marissa Mayer, 王兴, 风投, Windows, 内核, NT, 内存管理, x86]
---


1. 我刚刚更新了#雅虎CEO 8.2.7 beta 3 build 9527 夏日清凉版#，全新推出18小时续航省电模式，多套精美女神壁纸，买一赠一~清凉夏日版，快来和我一起开启新能量吧！记得App Store给五星哦亲~

2. 我现在可喜欢理发了。——这样一来就又可以到处冒充王兴了。

3. 
   > Qing：打工没前途，快点创业吧！到时候别忘了招我去做行政主管。

   > Kang：放心，不会忘的，创业的时候一定记得找你借钱。

   > Yi：“借”多不好，还要还的，算风投吧~

   > Kang：有道理，不如今天这顿你们俩就结了吧，算融个A轮~

   > Yi：原来风投的要义在于首先让创业者吃饱……

4. 《Windows内存管理》第三章：

    * 分清楚哪些是硬件特性哪些是软件特性是理解操作系统运作方式的关键。

    * MMU的特性很大程度上决定了OS的分页内存管理实现，MMU负责将虚拟地址映射到物理地址：
    
        1. 根据虚拟地址算出地址所属页面；
        
        2. 基于CR3寄存器找到页面映射表，计算出页面表项所在的物理位置
        
        3. 在TLB中查找表项内容
        
        4. 如果miss，发起额外的内存访问将表项载入TLB
        
        5. 检查表项相应的标志位，看是否已经映射到了物理内存，或者映射到某swap文件，或page fault。 除此之外，MMU还承担了检查内存访问权限的责任。

    * Windows和Linux在x86上都绕过了“段式内存管理”，将段寄存器都置为0，程序中的虚拟地址都成为“线性地址”。

    * 所有进程的系统空间几乎都是公共的，除了PAGETABLE_MAP（不同进程内存映射表自然不同）和HYPERSPACE（某些物理页面临时映射到内核虚存空间）

    * page fault多发生在用户空间，但由于Windows允许swap部分系统空间页面，所以也有可能发生在系统空间。

    * 页面swap行为的主体是内核线程MiBalancerThread, 被周期性时钟唤醒。swap策略为LRU（最近最少被用到）

    * 可以通过共享映射区将一个物理页面映射到多个进程的用户空间，之所以需要，主要是因为：

        1. 进程间用以交换信息。 

        2. 共享页面可以被映射到一个磁盘文件，以该文件问倒换文件，利用页面倒换机制实现文件读写，可以省去文件读写的系统调用。

        在实际应用中，第二种用法非常普遍，以至于共享映射区更多地被称作“文件映射区”。


    * 用户空间是从Heap分配缓冲区的，在系统空间，也有类此的机制，叫做Pool：

        1. Heap是属于进程的，Pool是全局的

        2. Heap属于批发/零售模式，卖完了可以向内核继续进货；但Pool的大小基本上是固定的。

        3. Windows中有特色的是“可倒换页面池”——因为Windows内核比Linux大的多（图形服务也在内核），如果坚持内核页面不能swap的话，就会对物理内存配置提出过高的要求。
