---
layout: post
category : 儒林外史
title: 屌丝的自我修养（85）
date: 2012-08-23 00:14:47 +08:00
tagline:
tags: [传教, 北京, 上帝, 搜索, xapian, 倒排索引, stemming]
---


1. 我在北京遇到的传教士开场白一般都是，“先生我是信上帝的，有兴趣……”——业务太差了，什么就“信上帝的”，也就是哥为人厚道，要不然还不得让你当场写篇5000字的报告详细对比天主教、摩门教、新教、东正教、犹太教的教义并说明它们对上帝认识的异同？

2. 我都想好了，如果这哥们竟然真的答出来了，那我就祭出豆腐脑的咸甜问题摆平他。

3. 昨天和一帮长辈吃饭，一大叔语重心长地对另一大叔说，“你儿子花你钱你才有安全感，他要不花你钱你才着急呢”——作为一个供养政府的纳税人，我就没有这样的心态。

4. 搜索引擎中的document即被索引的内容，粒度可能是整个文本、一个段落、一句话等等，一般索引粒度过小，可能造成正确率高而召回率低，反则反之。term只词项，倒排索引即term到document的索引。xapian开源搜索库中Document包含term, value, data等概念，Values是附加在document上一种元数据，每一个document可以有多个values，这些values通过不同的数字来标识。Values被设计成在匹配过程中快速地访问，它们可以用作排序、排队多余重复的document和范围检索等用途。如果你仅仅是想存储某个字段以便作为结果显示，那么建议您最好将它们保存在document的data中。

5. Term集合的确定第一步往往是词条化

    * token normalization是将多个词条归为一个等价类的过程，实现时可通过拓展词表，将一个查询中的词项拓展为的多个词，然后将这些词对应的倒排记录表合并；也可以在索引构建时就对词进行拓展，把文档号同时索引在这些词的倒排表里。第一种增加了一个拓展词典，查询时需要更多时间；第二种则需要更多存储空间。

    * 现代的Web搜索引擎基本不用stop word表。1）采用压缩技术降低常用词索引的存储开销 2）通过常规词的权重计算方法将高频常用词对文档排序影响降低 3）采取在权重变小时，及早停止对倒排记录表的继续扫描，降低开销


    * stemming和lemmatization含义不同，前者通常指一个很粗略的去除单词两端词缀的启发式过程，能提高召回率但会降低正确率，英文最常用的stemming算法是Porter；后者通常指利用词汇表和词形分析来返回词的原型或词典中的词，是一种自然语言处理工具。

    * 要从词项归一中获得更好的效果，取决于语用分析而不只是词形分析。

    * xapian提供了`Xapian::TermGenerator::set_stemming_strategy`可以用来定制stemming策略 [Stemming Algorithms][1] 
 
6. 如果索引变化不是太快的话，可以采用skip list来加速倒排记录表的合并（布尔查询AND时有用）

7. 短语查询：

    * 二元词索引是一个简单并且效果不错的策略，但可能会大大增加词汇表大小。

    * positional index在倒排索引表中加入位置信息，可用于k词近邻搜索。会提高倒排记录表合并操作的渐进复杂性。xapian也支持位置索引（`Xapian::Document::add_posting`）

    * 一个混合策略是，对某些（热门）查询使用短语索引或二元词索引，而其他短语查询采用位置索引。

    * next word index(对每个词项，有个后续词索引记录他在文档中的下一个词项)是另一种混合索引机制，与单纯位置索引相比，增加了索引大小，但查询效率有显著提高。

[1]: http://xapian.org/docs/stemming.html "Stemming Algorithms"
